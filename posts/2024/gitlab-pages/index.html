<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Hugoで作成したウェブサイトをGitLab Pagesで公開する - Razl-Dazl</title><link rel=icon type=image/png href=/favicon.png><link rel=apple-touch-icon href=apple-touch-icon.png sizes=180x180><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Hugoで作成したウェブサイトをGitLab Pagesで公開する"><meta property="og:description" content="このブログ自体はGitHub Pagesで公開していますが、別ジャンルの物をGitLab Pagesで公開したかったので別途作成・・・そして色々な場所で躓いて半日くらい潰したのでメモ"><meta property="og:type" content="article"><meta property="og:url" content="/posts/2024/gitlab-pages/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-23T00:00:00+09:00"><meta property="article:modified_time" content="2024-06-23T00:00:00+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hugoで作成したウェブサイトをGitLab Pagesで公開する"><meta name=twitter:description content="このブログ自体はGitHub Pagesで公開していますが、別ジャンルの物をGitLab Pagesで公開したかったので別途作成・・・そして色々な場所で躓いて半日くらい潰したのでメモ"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300&family=Raleway:wght@200;300&display=swap" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link href=https://social.vivaldi.net/@396 rel=me><script src=/js/main.js></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]]}}</script></head><body class=single><div class="header wrapper"><h1 class=site-title><a href=/>Razl-Dazl</a></h1><div class=site-description><nav class="nav social"><ul class=flat></ul></nav></div><div class=menu-bar><nav class=nav><ul class=flat><li><a href=/>blog</a></li><li><a href=/diary/>diary</a></li><li><a href=/tags/%E6%95%B0%E5%AD%A6/>math</a></li><li><a href=http://396.gitbook.io/>396号実験室</a></li></ul></nav><div class=toggle><input id=darkmode-toggle type=checkbox>
<label class=darkmode-toggle-label for=darkmode-toggle><span id=darkmode-svg><svg width="100%" height="100%" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M604.086 139.132C771.61 180.428 896 331.802 896 512c0 211.935-172.065 384-384 384-144.187.0-269.92-79.641-335.571-197.296C228.619 728.859 289.176 746.12 353.733 746.12c196.02.0 355.164-159.144 355.164-355.164.0-98.384-40.09-187.478-104.811-251.824z" style="fill:#ddd"/></svg></span></label></div></div></div><div class="container with-side-section wrapper post"><div class="main section"><div class=post-header><div class=eyecatch><img src=/thumbnails/hugo.webp alt=eyecatch><div class=eyecatch-credit>© 2014 Steve Francia</div></div><h1 class=title>Hugoで作成したウェブサイトをGitLab Pagesで公開する</h1><div class=meta>Posted at &mdash; 2024-06-23</div></div><div class=markdown><p>このブログ自体はGitHub Pagesで公開していますが、別ジャンルの物をGitLab Pagesで公開したかったので別途作成・・・そして色々な場所で躓いて半日くらい潰したのでメモ</p><hr><h2 id=gitlab用の設定ファイル作成>GitLab用の設定ファイル作成</h2><p>リポジトリ直下に<code>.gitlab-ci.yml</code>を作成して内容は以下の通りにします</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#268bd2>image</span>: registry.gitlab.com/pages/hugo/hugo_extended:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>variables</span>:
</span></span><span style=display:flex><span><span style=color:#268bd2>  GIT_SUBMODULE_STRATEGY</span>: recursive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#268bd2>pages</span>:
</span></span><span style=display:flex><span><span style=color:#268bd2>  stage</span>: deploy
</span></span><span style=display:flex><span><span style=color:#268bd2>  environment</span>: production
</span></span><span style=display:flex><span><span style=color:#268bd2>  script</span>:
</span></span><span style=display:flex><span>    - hugo --gc --minify
</span></span><span style=display:flex><span><span style=color:#268bd2>  artifacts</span>:
</span></span><span style=display:flex><span><span style=color:#268bd2>    paths</span>:
</span></span><span style=display:flex><span>      - public
</span></span></code></pre></div><p>検索すると各所で出てくるテンプレートから少し変えています</p><p>早速1行目から、通常<code>registry.gitlab.com/pages/hugo:latest</code>となるところを<code>registry.gitlab.com/pages/hugo/hugo_extended:latest</code>へ変更しています</p><p>Hugoで使用するテーマにSCSSファイルが含まれているとビルドに失敗するケースがあり、その対策として変更しています</p><p>またビルド時のコマンドを<code>hugo --gc --minify</code>としていますが、<code>-gc</code>はクリーンアップ用、<code>--minify</code>は容量削減用に使用しています（どれくらい削減できるからは知らないけど・・・）</p><p>ファイル名は<code>.gitlab-ci.yml</code>ですのでお間違い無いように・・・筆者は最初のドットを忘れてしまいあれ動かないぞ・・・と悪戦苦闘しました</p><p>ファイル名が正しければ、VSCodeやgitlab.com上からファイルを参照したときにアイコンがキツネのマークになるはずなので、デプロイ走らないぞーって時は念の為もう一度確認しましょう</p><hr><h2 id=hugoの設定ファイル調整>Hugoの設定ファイル調整</h2><p><del>TOMLとかいう新参者は知らないので</del>ここではYAML前提で進めます</p><p><code>config.yml</code>の<code>baseURL</code>と<code>publishDir</code>を調整します</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#268bd2>baseURL</span>: /
</span></span><span style=display:flex><span><span style=color:#268bd2>publishDir</span>: public
</span></span></code></pre></div><p>今回はトップページを<code>https://hogehoge.gitlab.io/</code>の直下としたいので直下に指定しています</p><p><code>https://hogehoge.gitlab.io/blog/</code>以下を指定したい場合は<code>baseURL: /blog</code>のようになります</p><p><code>publishDir</code>はGitLabの設定ファイルの<code>paths</code>に対応させますので<code>publishDir: public</code>となります</p><p>試してはいませんが独自で<code>public</code>以外を指定した場合、デプロイに失敗する可能性が高いのでカスタマイズしないことをオススメします</p><hr><h2 id=pipeline確認>Pipeline確認</h2><p>設定ファイルが間違っていなければ、デプロイの処理自体は問題なく動くはずです</p><p>GitLab上の各リポジトリのBuild > Pipelines から自動ビルドが動作していることを確認します</p><p><img src=pipelines.jpg alt></p><p>失敗していた場合は設定ファイルを弄りましょう・・・</p><hr><h2 id=gitlab-pagesがそもそも有効になっているか>GitLab Pagesがそもそも有効になっているか</h2><p>その後、他の端末でアクセスしようとしたらページが表示されなかった為リポジトリの設定を確認</p><p>GitLabにブラウザからアクセスして、プロジェクトの設定 <code>Settings > General > Visibility, project features, permissions</code>のExpandボタンを押すとなんか設定が沢山出てくるので、Pagesの項で<code>Only Project Members</code>みたいな制限する設定になっていたら<code>Everyone</code>へ修正します</p><p><img src=pages.jpg alt></p><p>リポジトリ作成時にプライベートリポジトリとして作成していると、ここが勝手に制限するような項目に設定されてしまっている可能性があるので要確認（というか筆者はそうなっていた）</p><p>ちなみに今改めて設定値を確認したら、設定値が<code>Everyone With Access</code>となっていました、表記揺れがあるようなので一字一句に拘ると躓きそうですね・・・</p><hr><h2 id=webサイトのドメインがおかしい場合>Webサイトのドメインがおかしい場合</h2><p>いざWebサイトにアクセスしてみると勝手にリダイレクトが発動して、ドメインが通常<code>hogehoge.gitlab.io</code>となるはずが、<code>hogehoge-gitlab-io-hogehoge-56b349062a348969d0e23582346258e02e36.gitlab.io</code>のような、謎のハッシュ値つきの長ったらしいものになってしまうことがある</p><p>この場合はプロジェクトのページの<code>Deploy > Pages</code>の<code>Use unique domain</code>を確認すると勝手にチェックが入っているので、チェックを外して保存すると直る</p><p><img src=unique-domain.jpg alt></p><p>ここの設定変更の確認は、少し時間を置いてからプライベートウィンドウ・または別の端末で行うことを推奨します</p><p><del>現状プライベートウィンドウではリダイレクトが無くなったことを確認できていますが、GitLabでログインしたままのウインドウではリダイレクトが発動してしまい、Webサイトが正常に表示されない状態です・・・</del>
ブラウザのキャッシュ消したら表示された！めでたしめでたし</p><hr><h2 id=参考>参考</h2><ul><li><a href=https://discourse.gohugo.io/t/tocss-failed-to-transform-style-scss/42096>TOCSS: failed to transform &ldquo;style.scss&rdquo; - support - HUGO</a></li><li><a href=https://docs.gitlab.com/ee/tutorials/hugo/>Tutorial: Build, test, and deploy your Hugo site with GitLab | GitLab</a></li><li><a href=https://docs.gitlab.com/ee/user/project/pages/getting_started_part_one.html>GitLab Pages default domain names and URLs | GitLab</a></li><li><a href=https://stackoverflow.com/questions/77314640/unexpected-gitlab-page-url>Unexpected GitLab page URL - Stack Overflow</a></li></ul><p>GitHub Pagesとは色々使い勝手が異なるので疲れました・・・おしまい</p></div><div class=post-tags><nav class="nav tags"><ul class=flat><li class=tag><img src=/img/tags/hugo.webp alt="tag's icon">
<a href=/tags/hugo>Hugo</a></li></ul></nav></div><div class="related section"><h2 class=section-header>関連記事</h2><ul><li><a href=/posts/2023/hugo-rss-exclude/>Hugoのビルド時に特定の項目をRSSから除外する</a></li><li><a href=/posts/2023/hugo-video-wikilink/>Hugoビルド時にWikiLink形式の動画リンクを変換する</a></li><li><a href=/posts/2023/hugo-wsl2-lan/>WSL上のHugoサーバにLAN内の端末からアクセスする</a></li><li><a href=/posts/2023/windows-codeblock/>Windows環境の時だけコードブロックのフォントが汚いので直した</a></li><li><a href=/posts/2023/hugo-eyecatch/>Hugoでタグ毎にアイキャッチ画像を設定する</a></li></ul></div></div><div class="side section"><div class="author section"><h2 class=section-header>Author@zakuro</h2><div class=content-wrapper><img src=/avatar.jpg><p>Mastodon: <a href=https://social.vivaldi.net/@396>396@vivaldi.net</a></p></div></div><div class="related section"><h2 class=section-header>Tags</h2><div class=tag-cloud><nav class="nav tags"><ul><li class=tag><img src=/img/tags/android.webp alt="tag's icon">
<a href=/tags/android/>Android (17)</a></li><li class=tag><img src=/img/tags/css.webp alt="tag's icon">
<a href=/tags/css/>CSS (1)</a></li><li class=tag><img src=/img/tags/gitbook.webp alt="tag's icon">
<a href=/tags/gitbook/>GitBook (2)</a></li><li class=tag><img src=/img/tags/hugo.webp alt="tag's icon">
<a href=/tags/hugo/>Hugo (14)</a></li><li class=tag><img src=/img/tags/tag.webp alt="tag's icon">
<a href=/tags/javascript/>JavaScript (1)</a></li><li class=tag><img src=/img/tags/kotlin.webp alt="tag's icon">
<a href=/tags/kotlin/>Kotlin (12)</a></li><li class=tag><img src=/img/tags/mac.webp alt="tag's icon">
<a href=/tags/mac/>Mac (7)</a></li><li class=tag><img src=/img/tags/obsidian.webp alt="tag's icon">
<a href=/tags/obsidian/>Obsidian (4)</a></li><li class=tag><img src=/img/tags/python.webp alt="tag's icon">
<a href=/tags/python/>Python (1)</a></li><li class=tag><img src=/img/tags/tag.webp alt="tag's icon">
<a href=/tags/rom%E7%84%BC%E3%81%8D/>ROM焼き (6)</a></li><li class=tag><img src=/img/tags/tag.webp alt="tag's icon">
<a href=/tags/%E3%81%9D%E3%81%AE%E4%BB%96/>その他 (8)</a></li><li class=tag><img src=/img/tags/%e6%95%b0%e5%ad%a6.webp alt="tag's icon">
<a href=/tags/%E6%95%B0%E5%AD%A6/>数学 (6)</a></li><li class=tag><img src=/img/tags/tag.webp alt="tag's icon">
<a href=/tags/%E9%9F%B3%E3%82%B2%E3%83%BC/>音ゲー (3)</a></li></ul></nav></div><h2 class=section-header>Archive</h2><a href=/all/>All posts</a></div></div></div><div class="footer wrapper"><nav class=nav><div>Razl-Dazl - g396.github.io | <a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div></body></html>