<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Appleシリコン搭載MacでWaydroidを動かす - Razl-Dazl</title><link rel=icon type=image/png href=/favicon.png><link rel=apple-touch-icon href=apple-touch-icon.png sizes=180x180>
<meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="/posts/2024/utm-waydroid/"><meta property="og:site_name" content="Razl-Dazl"><meta property="og:title" content="Appleシリコン搭載MacでWaydroidを動かす"><meta property="og:description" content="MacBook Air(M3)上のmacOSにてDebianの仮想環境を構築し、更にその上でWaydroidを導入することによりAndroidアプリの実行環境を構築しました"><meta property="og:locale" content="ja_jp"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-27T00:00:00+09:00"><meta property="article:modified_time" content="2024-12-27T00:00:00+09:00"><meta property="article:tag" content="Mac"><meta name=twitter:card content="summary"><meta name=twitter:title content="Appleシリコン搭載MacでWaydroidを動かす"><meta name=twitter:description content="MacBook Air(M3)上のmacOSにてDebianの仮想環境を構築し、更にその上でWaydroidを導入することによりAndroidアプリの実行環境を構築しました"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300&family=Raleway:wght@200;300&display=swap" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link href=https://social.vivaldi.net/@396 rel=me><script src=/js/main.js></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]]}}</script></head><body class=single><div class="header wrapper"><h1 class=site-title><a href=/>Razl-Dazl</a></h1><div class=site-description><nav class="nav social"><ul class=flat></ul></nav></div><div class=menu-bar><nav class=nav><ul class=flat><li><a href=/>blog</a></li><li><a href=/diary/>diary</a></li><li><a href=/tags/%E6%95%B0%E5%AD%A6/>math</a></li><li><a href=http://396.gitbook.io/>Lab.396</a></li></ul></nav><div class=toggle><input id=darkmode-toggle type=checkbox>
<label class=darkmode-toggle-label for=darkmode-toggle><span id=darkmode-svg><svg width="100%" height="100%" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M604.086 139.132C771.61 180.428 896 331.802 896 512c0 211.935-172.065 384-384 384-144.187.0-269.92-79.641-335.571-197.296C228.619 728.859 289.176 746.12 353.733 746.12c196.02.0 355.164-159.144 355.164-355.164.0-98.384-40.09-187.478-104.811-251.824z" style="fill:#ddd"/></svg></span></label></div></div></div><div class="container with-side-section wrapper post"><div class="main section"><div class=post-header><div class=eyecatch><img src=/thumbnails/mac.webp alt=eyecatch><div class=eyecatch-credit></div></div><h1 class=title>Appleシリコン搭載MacでWaydroidを動かす</h1><div class=meta>Posted at &mdash; 2024-12-27</div></div><div class=markdown><p>MacBook Air(M3)上のmacOSにてDebianの仮想環境を構築し、更にその上でWaydroidを導入することによりAndroidアプリの実行環境を構築しました</p><h2 id=utm導入>UTM導入</h2><p>仮想環境を構築するソフトウェアは複数ありますが、今回はオープンソースのUTMを使用します</p><p>App Storeでは有料配布されていますが、<a href=https://mac.getutm.app>本家の公式ページ</a>からは無料ダウンロードできます</p><p>インストール手順は省略</p><h2 id=debian環境構築>Debian環境構築</h2><p>UTMでは様々なOSを動かせますが今回はDebianにしました</p><p>「Androidを直接UTM上で動作させれば良いのでは？」と思ったそこの貴方、UTMはAndroidの実行は非推奨なのです</p><p>現に、主要なLinuxディストリビューションのイメージについてはUTMのページからダウンロード出来ますが、Androidについては削除されてしまったようで・・・</p><p>Debianの導入は<a href=https://mac.getutm.app/gallery/debian-12>UTMのページ</a>から行うのが楽です</p><p><img src=1.jpg alt></p><p>（UTMのインストール後に）上記ページの「Open in UTM」を押してUTMに遷移し、ダイアログの指示に従うとダウンロードと初期設定が自動で行われますので、メチャメチャ楽にDebian環境が構築できます</p><p>一応、Debian以外でもWaydroidの使用は可能ですが、</p><ul><li>Waydroidの使用にはWayland環境である必要がある</li><li>ディストリビューションによってはDLに時間がかかる(多分Debianが一番早い)</li></ul><p>ということでDebianをおすすめします</p><h2 id=waydroid導入>Waydroid導入</h2><p>Debian上でターミナルを開いて</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install curl -y
</span></span><span style=display:flex><span>curl -s https://repo.waydro.id | sudo bash
</span></span><span style=display:flex><span>sudo apt install waydroid -y
</span></span></code></pre></div><p>を実行。curlさえ入っていなかったのでcurlの導入からです</p><h2 id=waydroid用のイメージの準備について>Waydroid用のイメージの準備について</h2><p>通常の使用法であれば、WaydroidのGUI上でイメージをダウンロードして実行となるわけですが、その手順を踏んだ場合、AppleシリコンなMac(上のUTM)では動作しません</p><p><a href=https://github.com/waydroid/waydroid/issues/644>Waydroidのissue</a>によると・・・</p><p>既存のイメージは32bitをサポートしているがAppleシリコンでは32bitをサポートしないので、64bitオンリーなイメージを用意する必要がある、とのこと</p><p>issue内に64bitのイメージを用意してリンクを貼ってくれた人が居たので、そこからイメージを別途ダウンロードします</p><p>展開するとイメージが2つ(system.zipとvendor.zip)が出てくるのでこれを使用します</p><p><a href=https://docs.waydro.id/faq/using-custom-waydroid-images>Waydroidのドキュメント</a>に、自分でイメージを用意して起動する方法が書いてあるので、これに合わせてターミナルでいろいろ打っていきます</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo mkdir -p /etc/waydroid-extra/images
</span></span><span style=display:flex><span>sudo unzip system.zip -d /etc/waydroid-extra/images
</span></span><span style=display:flex><span>sudo unzip vendor.zip -d /etc/waydroid-extra/images
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#586e75># 必要に応じてzip削除</span>
</span></span><span style=display:flex><span>rm system.zip vendor.zip
</span></span></code></pre></div><p>あとは初期化処理を実行するだけで問題ない・・・はず</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo waydroid init -f
</span></span></code></pre></div><h2 id=google-play開発者サービス-を使えるようにする>Google Play開発者サービス を使えるようにする</h2><p>Waydroidが正常起動した方、おめでとうございます</p><p>まだまだやる事が沢山残っています</p><p>最近のGoogleは未認証のデバイスを弾くようになりました</p><p>WaydroidをインストールしただけではGoogleの各サービスが使えず、ログインも出来ません</p><p><img src=2.jpg alt></p><p>と言っても、ちゃんと解決方法が存在します</p><p>Waydroidを起動した状態で、ターミナルから以下を入力してデバイスIDを取得</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo waydroid shell
</span></span><span style=display:flex><span><span style=color:#268bd2>ANDROID_RUNTIME_ROOT</span><span style=color:#719e07>=</span>/apex/com.android.runtime <span style=color:#268bd2>ANDROID_DATA</span><span style=color:#719e07>=</span>/data <span style=color:#268bd2>ANDROID_TZDATA_ROOT</span><span style=color:#719e07>=</span>/apex/com.android.tzdata <span style=color:#268bd2>ANDROID_I18N_ROOT</span><span style=color:#719e07>=</span>/apex/com.android.i18n sqlite3 /data/data/com.google.android.gsf/databases/gservices.db <span style=color:#2aa198>&#34;select * from main where name = \&#34;android_id\&#34;;&#34;</span>
</span></span><span style=display:flex><span>android_id|XXXXXXXXXXXXXXXXXX
</span></span></code></pre></div><p><code>android_id</code>の後に数字の羅列が出力されるので、これを<a href=https://www.google.com/android/uncertified>Googleの登録用フォーム</a>に入力します</p><p><img src=3.jpg alt></p><p>登録ボタンを押してから30分くらい経つと登録が受理され、Googleの各サービスが利用できるようになります</p><h2 id=gapps導入>GApps導入</h2><p>今回使用したイメージにはPlayストアが入っていなかったので、別途自力でインストールしなければなりません</p><p><a href=https://github.com/casualsnek/waydroid_script>waydroid_script</a>を使用してインストールします</p><p>実行にはPython(とpip)の環境が必要なので、そちらも整えておきます</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install python3-full
</span></span><span style=display:flex><span>sudo apt install pip
</span></span></code></pre></div><p>ドキュメントにも書いてありますが、依存関係のあるパッケージを別途導入</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install lzip
</span></span></code></pre></div><p>waydroid_scriptを<code>git clone</code>するなりzipでダウンロードするなりして、ファイルを実行</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 -m venv venv
</span></span><span style=display:flex><span>venv/bin/pip install -r requirements.txt
</span></span><span style=display:flex><span>sudo venv/bin/python3 main.py install gapps
</span></span></code></pre></div><p>・・・で、ここで私は1度躓きました</p><p>ファイルのダウンロードが何回も繰り返されてしまうので、よくよく見てみると「MD5が一致しないのでやり直す」といった旨が出力されていました</p><p>ソースコードを眺めてみます</p><p>GAppsのダウンロード先は、<code>waydroid_script/stuff/gapps.py</code>の10行目に定義されていました</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>dl_links <span style=color:#719e07>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#34;11&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#2aa198>&#34;x86_64&#34;</span>: [<span style=color:#2aa198>&#34;https://sourceforge.net/projects/opengapps/files/x86_64/20220503/open_gapps-x86_64-11.0-pico-20220503.zip&#34;</span>, <span style=color:#2aa198>&#34;5a6d242be34ad1acf92899c7732afa1b&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#2aa198>&#34;x86&#34;</span>: [<span style=color:#2aa198>&#34;https://sourceforge.net/projects/opengapps/files/x86/20220503/open_gapps-x86-11.0-pico-20220503.zip&#34;</span>, <span style=color:#2aa198>&#34;efda4943076016d00b40e0874b12ddd3&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#2aa198>&#34;arm64-v8a&#34;</span>: [<span style=color:#2aa198>&#34;https://sourceforge.net/projects/opengapps/files/arm64/20220503/open_gapps-arm64-11.0-pico-20220503.zip&#34;</span>, <span style=color:#2aa198>&#34;7790055d34bbfc6fe610b0cd263a7add&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#2aa198>&#34;armeabi-v7a&#34;</span>: [<span style=color:#2aa198>&#34;https://sourceforge.net/projects/opengapps/files/arm/20220215/open_gapps-arm-11.0-pico-20220215.zip&#34;</span>, <span style=color:#2aa198>&#34;8719519fa32ae83a62621c6056d32814&#34;</span>]
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#34;13&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#2aa198>&#34;x86_64&#34;</span>: [<span style=color:#2aa198>&#34;https://github.com/s1204IT/MindTheGappsBuilder/releases/download/20231028/MindTheGapps-13.0.0-x86_64-20231028.zip&#34;</span>, <span style=color:#2aa198>&#34;63ccebbf93d45c384f58d7c40049d398&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#2aa198>&#34;x86&#34;</span>: [<span style=color:#2aa198>&#34;https://github.com/s1204IT/MindTheGappsBuilder/releases/download/20231028/MindTheGapps-13.0.0-x86-20231028.zip&#34;</span>, <span style=color:#2aa198>&#34;f12b6a8ed14eedbb4b5b3c932a865956&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#2aa198>&#34;arm64-v8a&#34;</span>: [<span style=color:#2aa198>&#34;https://github.com/s1204IT/MindTheGappsBuilder/releases/download/20231028/MindTheGapps-13.0.0-arm64-20231028.zip&#34;</span>, <span style=color:#2aa198>&#34;11180da0a5d9f2ed2863882c30a8d556&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#2aa198>&#34;armeabi-v7a&#34;</span>: [<span style=color:#2aa198>&#34;https://github.com/s1204IT/MindTheGappsBuilder/releases/download/20231028/MindTheGapps-13.0.0-arm-20231028.zip&#34;</span>, <span style=color:#2aa198>&#34;d525c980bac427844aa4cb01628f8a8f&#34;</span>]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>ダウンロード先のURLと共に、ファイルのMD5が固定値で定義されていました</p><p><a href=https://sourceforge.net/projects/opengapps/files/arm64/20220503/>SourceForge上のARM版のファイル一覧</a>に、ソースコードの実態とともにMD5が記載されたテキストファイル(拡張子が<code>.md5</code>のもの）がアップされているのでそちらをDLして、正しいハッシュ値に書き換えます</p><p>私の環境では、使用するGAppsがAndroid11対応かつARM64(arm64-v8a)のものでしたので、<code> 7790055d34bbfc6fe610b0cd263a7add</code>を正しい値へ置き換えました</p><p>そして<code>main.py</code>をもう一度実行・・・</p><p><img src=4.jpg alt></p><p>無事にPlayストアが追加されました！</p><p>ここまで長かった。Appleシリコンだと一筋縄で行きませんね・・・</p><h2 id=ブルアカが動かなかった>ブルアカが動かなかった</h2><p><img src=5.jpg alt></p><p>ブルアカをやりたかったのでダウンロードしましたが、起動しても真っ黒な画面のまま進みませんでした</p><p>ARMonARMですからそこそこのパフォーマンスで動いたらいいなぁ〜と淡い期待を抱いていましたが、動作すらせず・・・</p><p>Macでブルアカをしたいのであれば、iPhoneのミラーリングを使用するのが無難ですね</p><p>フルスクリーンに出来ないのが欠点ですが、遅延もほとんど感じないのでデイリーを回す程度であれば十分です</p><p>ただゲームが動かないとなると、MacでWaydroidを動かす意義が薄れてしまいますね・・・</p><p>また、M3チップがサポート外なので今回は試していませんが、Asahi Linux上でWaydroidを実行する手もあるので、サポートされた暁にはリベンジしようかと思います</p><h2 id=参考>参考</h2><p>道中で記載したものは除きます</p><ul><li><a href=https://docs.waydro.id/faq/google-play-certification>Google Play Certification</a></li><li><a href=https://www.reddit.com/r/waydroid/comments/1fjmddf/how_to_upgrade_from_vanilla_to_gapps/>How to upgrade from VANILLA to GAPPS?</a></li><li><a href=https://webzoit.net/hp/it/internet/homepage/env/os/bsd_unix_linux/debian/etc/lineageos_based_android_using_waydroid_on_debian_amd64.html>DebianにWaydroidで爆速快適なAndroidを使ってみる</a></li></ul></div><div class=post-tags><nav class="nav tags"><ul class=flat><li class=tag><img src=/img/tags/mac.webp alt="tag's icon">
<a href=/tags/mac>Mac</a></li></ul></nav></div><div class="related section"><h2 class=section-header>関連記事</h2><ul><li><a href=/posts/2022/mac-mini/>Mac miniを壁や机に固定すると便利って話</a></li><li><a href=/posts/2022/mac-fusion-drive/>Fusion Drive搭載iMacでパーティションを切っていた場合の初期化手順</a></li><li><a href=/posts/2022/mac-rec/>macOSで音源付きの録画を行う</a></li><li><a href=/posts/2021/mac-dualboot/>macOS同士のデュアルブート</a></li><li><a href=/posts/2021/mac-bigsur-python/>Big Surを再インストールしたらpythonが動かなくなった</a></li></ul></div></div><div class="side section"><div class="author section"><h2 class=section-header>Author@zakuro</h2><div class=content-wrapper><img src=/avatar.jpg><p>Mastodon: <a href=https://social.vivaldi.net/@396>396@vivaldi.net</a></p></div></div><div class="related section"><h2 class=section-header>Tags</h2><div class=tag-cloud><nav class="nav tags"><ul><li class=tag><img src=/img/tags/android.webp alt="tag's icon">
<a href=/tags/android/>Android (17)</a></li><li class=tag><img src=/img/tags/css.webp alt="tag's icon">
<a href=/tags/css/>CSS (1)</a></li><li class=tag><img src=/img/tags/gitbook.webp alt="tag's icon">
<a href=/tags/gitbook/>GitBook (2)</a></li><li class=tag><img src=/img/tags/hugo.webp alt="tag's icon">
<a href=/tags/hugo/>Hugo (15)</a></li><li class=tag><img src=/img/tags/tag.webp alt="tag's icon">
<a href=/tags/javascript/>JavaScript (1)</a></li><li class=tag><img src=/img/tags/kotlin.webp alt="tag's icon">
<a href=/tags/kotlin/>Kotlin (12)</a></li><li class=tag><img src=/img/tags/mac.webp alt="tag's icon">
<a href=/tags/mac/>Mac (9)</a></li><li class=tag><img src=/img/tags/obsidian.webp alt="tag's icon">
<a href=/tags/obsidian/>Obsidian (4)</a></li><li class=tag><img src=/img/tags/python.webp alt="tag's icon">
<a href=/tags/python/>Python (1)</a></li><li class=tag><img src=/img/tags/tag.webp alt="tag's icon">
<a href=/tags/rom%E7%84%BC%E3%81%8D/>ROM焼き (6)</a></li><li class=tag><img src=/img/tags/tag.webp alt="tag's icon">
<a href=/tags/%E3%81%9D%E3%81%AE%E4%BB%96/>その他 (8)</a></li><li class=tag><img src=/img/tags/%e6%95%b0%e5%ad%a6.webp alt="tag's icon">
<a href=/tags/%E6%95%B0%E5%AD%A6/>数学 (6)</a></li><li class=tag><img src=/img/tags/tag.webp alt="tag's icon">
<a href=/tags/%E9%9F%B3%E3%82%B2%E3%83%BC/>音ゲー (3)</a></li></ul></nav></div><h2 class=section-header>Archive</h2><a href=/all/>All posts</a></div></div></div><div class="footer wrapper"><nav class=nav><div>Razl-Dazl | <a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div></body></html>